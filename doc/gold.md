### **项目需求文档 (v1.1): 贵金属价格查询 MCP 组件**

#### 1. 项目概述

**目标**: 开发一个可通过 `npx` 命令安装和执行的 MCP (Model Context Protocol) 组件。该组件的核心功能是作为一个 MCP 工具，用于查询黄金和白银在世界主要交易市场的每日现货与期货价格。

**主要用户**: 需要在自动化流程或语言模型交互中获取贵金属价格的开发者或系统。

**最终产物**:

1. 一个发布在 npm 上的、可通过 `npx` 调用的 Node.js 包。
2. 一个实现了 MCP `tool` 接口的 TypeScript 模块。
3. 清晰的 `README.md` 文档，说明如何安装、配置和使用该组件。

#### 2. 核心功能需求

##### 2.1. 数据查询功能

该 MCP 工具必须能够获取以下金融数据：

* **交易品种**:
  * 黄金 (Gold)
  * 白银 (Silver)
* **价格类型**:
  * 现货价格 (Spot Price)
  * 期货价格 (Futures Price)
* **交易市场**:
  * 纽约 (New York)
  * 伦敦 (London)
  * 上海 (Shanghai)

##### 2.2. MCP 工具接口定义 (`tool`)

* **工具名称**: `getPreciousMetalPrice`
* **工具描述**: "获取黄金或白银在指定市场的每日价格，并将其转换为以'克/人民币'为单位。"
* **输入参数**:
  * `metal` (string, 必选): `"gold"`, `"silver"`。
  * `type` (string, 必选): `"spot"`, `"futures"`。
  * `market` (string, 必选): `"new_york"`, `"london"`, `"shanghai"`。
* **输出**:
  * 成功时，返回一个结构化的 JSON 字符串，包含原始价格和转换后的价格。

        ```json
        {
          "metal": "gold",
          "type": "spot",
          "market": "new_york",
          "original_price": {
            "value": 2350.55,
            "unit": "USD/oz" 
          },
          "converted_price": {
            "value": 558.85,
            "unit": "CNY/gram"
          },
          "exchange_rate": {
            "from": "USD",
            "to": "CNY",
            "rate": 7.25
          },
          "timestamp": "2023-10-27T18:00:00Z"
        }
        ```

  * 失败时，返回一个描述错误的 MCPError。

##### 2.3. 数据处理与单位转换

为了将原始市场价格（通常以“美元/盎司”计价）转换为最终的“元/克”单位，组件必须执行以下计算：

1. **重量单位转换**:
    * 贵金属的国际标准计价单位是**金衡盎司 (troy ounce)**。
    * 转换因子： **1 金衡盎司 = 31.1034768 克**。
    * 程序将使用此固定值进行转换。

2. **货币单位转换**:
    * 原始价格（如美元、英镑）需要转换为人民币 (CNY)。
    * 程序将**实时查询**相应货币对的汇率（例如：`USD/CNY`, `GBP/CNY`）。
    * 汇率数据将与价格数据一并获取，以确保时效性。

3. **最终价格计算公式**:
    * `价格 (元/克) = [原始价格 (外币/盎司) ÷ 31.1034768] × 汇率 (人民币/外币)`

#### 3. 技术规格与实现细节

##### 3.1. 数据源 API

* **主要数据提供商**: [Finnhub.io](https://finnhub.io/)
* **所需 API 端点**:
    1. **商品/贵金属价格 API**: 用于获取黄金和白银的原始价格（例如 `XAU/USD`）。
    2. **外汇汇率 API**: 用于获取将价格从美元(USD)或英镑(GBP)等货币转换为人民币(CNY)所需的实时汇率。我们将优先使用 Finnhub 提供的外汇 API 来保持数据源的一致性。
* **API 认证**: 需要使用 Finnhub API 密钥，通过环境变量 `FINNHUB_API_KEY` 进行配置。

##### 3.2. 项目技术栈

* **语言**: TypeScript
* **框架**: FastMCP
* **包管理器**: npm / pnpm
* **运行环境**: Node.js

##### 3.3. 安装与分发

* 项目将被打包并发布到 npm 公共仓库。
* `package.json` 中将包含一个 `bin` 字段，允许通过 `npx your-package-name` 直接运行。

#### 4. 假设与限制

* **数据实时性**: 本项目旨在获取“每日”价格，而非高频或实时流式数据。通常是获取查询时刻的最新报价或前一交易日的收盘价。
* **期货数据**: 期货价格与特定合约相关（如月份），API 可能返回主力合约的价格。我们将优先获取最相关的主力合约价格。
* **市场对应**: Finnhub 中的数据可能不直接以"纽约"、"伦敦"、"上海"命名，我们将通过对应的货币对来映射市场（如 USD -> 纽约, GBP -> 伦敦, CNH/CNY -> 上海）。
* **API 依赖**: 功能的稳定性和数据的准确性强依赖于 Finnhub API 的可用性和服务条款。
